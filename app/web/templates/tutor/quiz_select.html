{% extends "base.html" %}
{% block content %}
<div class="card">
  <div class="flex items-center justify-between">
    <h1 class="text-xl font-semibold">Gerar prova - {{ doc.title }}</h1>
    <a class="btn btn-ghost" href="/tutor">Voltar</a>
  </div>

  <div class="card mt-4">
    <div class="flex items-center gap-2">
      <h3 class="font-semibold mb-2">Gerar Provas</h3>
      <div class="relative group cursor-pointer select-none">
        <span class="text-black-600 font-bold border border-black-600 rounded-full px-[6px]">?</span>
        <div class="absolute left-1/2 -translate-x-1/2 top-full mt-1 hidden group-hover:block
                    bg-gray-900 text-white text-xs p-2 rounded shadow-lg w-64 z-10">
          Gere quantas provas desejar entre as 3 opções disponíveis.
          Você pode refazer suas provas quantas vezes desejar.
        </div>
      </div>
    </div>
    <form action="/tutor/doc/{{ doc.id }}/quiz/create" method="post" class="mt-2 space-y-3"
      data-require-one-of="tipos">
      <div class="flex items-center gap-3">
        <span class="text-sm text-gray-600">Tipos de questão:</span>
            <label class="inline-flex items-center gap-2 cursor-pointer select-none">
          <input type="checkbox" name="tipos" value="mc" class="hidden peer" checked>
          <span class="px-3 py-1 rounded-full border peer-checked:bg-indigo-600 peer-checked:text-white
                       border-indigo-600 text-indigo-700 hover:bg-indigo-50 transition text-sm">
            Alternativas
          </span>
        </label>
            <label class="inline-flex items-center gap-2 cursor-pointer select-none">
          <input type="checkbox" name="tipos" value="vf" class="hidden peer">
          <span class="px-3 py-1 rounded-full border peer-checked:bg-indigo-600 peer-checked:text-white
                       border-indigo-600 text-indigo-700 hover:bg-indigo-50 transition text-sm">
            Verdadeiro/Falso
          </span>
        </label>
            <label class="inline-flex items-center gap-2 cursor-pointer select-none">
          <input type="checkbox" name="tipos" value="disc" class="hidden peer">
          <span class="px-3 py-1 rounded-full border peer-checked:bg-indigo-600 peer-checked:text-white
                       border-indigo-600 text-indigo-700 hover:bg-indigo-50 transition text-sm">
            Discursiva
          </span>
        </label>
      </div>
      <div class="flex items-end gap-3">
        <label>Qtd. questões
          <input class="input" type="number" min="3" max="30" value="10" name="n" style="width:6rem">
        </label>
        <div class="relative group cursor-pointer select-none">
          <span class="text-black-600 font-bold border border-black-600 rounded-full px-[6px]">?</span>
          <div class="absolute left-1/2 -translate-x-1/2 top-full mt-1 hidden group-hover:block
                      bg-gray-900 text-white text-xs p-2 rounded shadow-lg w-64 z-10">
            Você pode marcar mais de um tipo. A distribuição é feita igualmente entre os tipos selecionados. 
            Se não marcar nenhum tipo a prova sera de Alternativas
          </div>
        </div>
        <button class="btn btn-ghost">Gerar</button>
      </div>
    </form>
  </div>

  <div class="card mt-4">
    <h2 class="text-lg font-semibold">Provas geradas neste tema</h2>
    {% if quiz_stats %}
    <div class="overflow-x-auto mt-2">
      <table class="min-w-full text-sm">
        <thead>
          <tr>
            <th class="text-left p-2">Criada em</th>
            <th class="text-left p-2">Tipo</th>
            <th class="text-left p-2"># Tentativas</th>
            <th class="text-left p-2">Média</th>
            <th class="text-left p-2">Melhor</th>
            <th class="text-left p-2">Ação</th>
          </tr>
        </thead>
        <tbody>
          {% for q in quiz_stats %}
          <tr class="border-t">
            <td class="p-2">{{ q.created_at }}</td>
            <td class="p-2">{{ type_labels.get(q.quiz_type, q.quiz_type) }}</td>
            <td class="p-2">{{ q.attempts }}</td>
            <td class="p-2">{{ '%.1f' % q.avg_score }}/10</td>
            <td class="p-2">{{ q.best_score }}/10</td>
            <td class="p-2">
              <a class="btn btn-ghost" href="/tutor/quiz/{{ q.quiz_id }}">Refazer</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <p class="text-gray-600 mt-2">Nenhuma prova gerada ainda para este documento.</p>
    {% endif %}
  </div>
  
  <div class="card mt-4">
    <h2 class="text-lg font-semibold">Tentativas realizadas</h2>
    {% if attempt_rows %}
    <div class="overflow-x-auto mt-2">
      <table class="min-w-full text-sm">
        <thead>
          <tr>
            <th class="text-left p-2">Data</th>
            <th class="text-left p-2">Tipo</th>
            <th class="text-left p-2">Nota</th>
            <th class="text-left p-2">Abrir</th>
          </tr>
        </thead>
        <tbody>
          {% for row in attempt_rows %}
          <tr class="border-t">
            <td class="p-2">{{ row.attempt_at }}</td>
            <td class="p-2">{{ type_labels.get(row.quiz_type, row.quiz_type) }}</td>
            <td class="p-2">{{ row.score }}/{{ row.max_score }}</td>
            <td class="p-2">
              <a class="btn btn-ghost" href="/tutor/quiz/{{ row.quiz_id }}">Ver prova</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <p class="text-gray-600 mt-2">Nenhuma tentativa registrada ainda.</p>
    {% endif %}
  </div>
  
</div>
{% endblock %}
